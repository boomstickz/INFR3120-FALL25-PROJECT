<%- include('../partials/header.ejs') %>
<%- include('../partials/main_nav.ejs') %>

<main class="main-shell">
  <section class="page-hero">

    <div>
      <p class="eyebrow">Forge a new legend</p>
      <h2 class="page-title">Create a character</h2>
      <p class="page-subtitle">
        Shape every stat, skill, and story beat to match the look and feel of the Forge My Hero home page.
      </p>
      <div class="hero-actions">
        <a href="/characters" class="btn-ghost">Back to characters</a>
      </div>
    </div>

    <aside class="hero-card hero-gallery" data-gallery data-initial-images="<%- encodeURIComponent(JSON.stringify([])) %>">
      <div class="hero-portrait-grid is-empty" data-gallery-grid>
        <div class="gallery-empty">
          <i class="fa-regular fa-image"></i>
          <p>Drop up to four heroic portraits.</p>
        </div>
      </div>
      <div class="hero-card-actions">
        <input type="file" accept="image/*" multiple data-gallery-input hidden form="characterForm" />
        <input type="hidden" name="portraits" value="[]" data-gallery-field form="characterForm" />
        <div class="gallery-buttons">
          <button type="button" class="btn-ember" data-add-btn>Add image</button>
          <button type="button" class="btn-ghost" data-remove-btn disabled>Remove image</button>
        </div>
        <p class="hero-portrait-caption">Upload any number of imagesâ€”four display in the frame at once. Images stay in the browser until the form saves them as base64 strings.</p>
      </div>
    </aside>


  </section>

  <section class="panel forge-panel">
    <header class="panel-header">
      <h3>Character details</h3>
      <p class="panel-subtitle">Fill out the essentials, then dial in combat stats and proficiencies.</p>
    </header>

    <form id="characterForm" method="post" class="forge-form">
      <div class="form-grid two-col">
        <div class="form-card">
          <h3 class="form-heading">Identity</h3>
          <div class="field">
            <label for="characterNameTextField">Character Name</label>
            <input id="characterNameTextField" name="characterName" type="text" class="forge-input" placeholder="Strix" required />
          </div>
          <div class="field-grid">
            <div class="field">
              <label for="classLevelTextField">Class &amp; Level</label>
              <input id="classLevelTextField" name="classLevel" type="text" class="forge-input" placeholder="Paladin 8" required />
            </div>
            <div class="field">
              <label for="backgroundTextField">Background</label>
              <input id="backgroundTextField" name="background" type="text" class="forge-input" placeholder="Haunted One" required />
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label for="raceTextField">Race</label>
              <input id="raceTextField" name="race" type="text" class="forge-input" placeholder="Aasimar - Fallen" required />
            </div>
            <div class="field">
              <label for="alignmentTextField">Alignment</label>
              <input id="alignmentTextField" name="alignment" type="text" class="forge-input" placeholder="LE" required />
            </div>
          </div>
        </div>

        <div class="form-card">
          <h3 class="form-heading">Battle readiness</h3>
          <div class="field-grid three-col">
            <div class="field">
              <label for="armorClassField">Armor Class</label>
              <input id="armorClassField" name="armorClass" type="number" class="forge-input" placeholder="18" />
            </div>
            <div class="field">
              <label for="initiativeField">Initiative</label>
              <input id="initiativeField" name="initiative" type="text" class="forge-input" placeholder="+0" />
            </div>
            <div class="field">
              <label for="proficiencyBonusField">Prof. Bonus</label>
              <input id="proficiencyBonusField" name="proficiencyBonus" type="number" class="forge-input" placeholder="+2" />
            </div>
          </div>

          <div class="field-grid three-col">
            <div class="field">
              <label for="maxHPField">Hit Point Maximum</label>
              <input id="maxHPField" name="maxHP" type="number" class="forge-input" placeholder="0" />
            </div>
            <div class="field">
              <label for="currentHPField">Current Hit Points</label>
              <input id="currentHPField" name="currentHP" type="number" class="forge-input" placeholder="0" />
            </div>
            <div class="field">
              <label for="tempHPField">Temporary HP</label>
              <input id="tempHPField" name="tempHP" type="number" class="forge-input" placeholder="0" />
            </div>
          </div>

          <label class="checkbox-pill">
            <input type="checkbox" id="inspirationCheckBox" name="inspiration" value="true" />
            <span>Inspiration</span>
          </label>
        </div>
      </div>

      <div class="form-card">
        <h3 class="form-heading">Ability scores</h3>
        <div class="ability-grid">
          <% const abilities = [
            { label: 'Strength', score: 'strengthScore', mod: 'strengthMod' },
            { label: 'Dexterity', score: 'dexterityScore', mod: 'dexterityMod' },
            { label: 'Constitution', score: 'constitutionScore', mod: 'constitutionMod' },
            { label: 'Intelligence', score: 'intelligenceScore', mod: 'intelligenceMod' },
            { label: 'Wisdom', score: 'wisdomScore', mod: 'wisdomMod' },
            { label: 'Charisma', score: 'charismaScore', mod: 'charismaMod' },
          ]; %>
          <% abilities.forEach(function(ability) { %>
            <div class="ability-card">
              <div class="ability-label"><%= ability.label %></div>
              <div class="ability-inputs">
                <input type="number" name="<%= ability.score %>" class="forge-input" placeholder="0" />
                <input type="text" name="<%= ability.mod %>" class="forge-input" placeholder="+0" />
              </div>
            </div>
          <% }); %>
        </div>
      </div>

      <div class="form-grid two-col">
        <div class="form-card">
          <h3 class="form-heading">Saving throws</h3>
          <div class="skill-list">
            <div class="skill-row"><span>Strength</span><input type="text" name="saveStrength" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Dexterity</span><input type="text" name="saveDexterity" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Constitution</span><input type="text" name="saveConstitution" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Intelligence</span><input type="text" name="saveIntelligence" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Wisdom</span><input type="text" name="saveWisdom" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Charisma</span><input type="text" name="saveCharisma" class="forge-input narrow" placeholder="+0" /></div>
          </div>

          <div class="passive-grid">
            <div class="field">
              <label for="passivePerceptionField">Passive Perception</label>
              <input id="passivePerceptionField" name="passivePerception" type="number" class="forge-input" placeholder="10" />
            </div>
            <div class="field">
              <label for="passiveInvestigationField">Passive Investigation</label>
              <input id="passiveInvestigationField" name="passiveInvestigation" type="number" class="forge-input" placeholder="10" />
            </div>
            <div class="field">
              <label for="passiveInsightField">Passive Insight</label>
              <input id="passiveInsightField" name="passiveInsight" type="number" class="forge-input" placeholder="10" />
            </div>
          </div>
        </div>

        <div class="form-card">
          <h3 class="form-heading">Skills</h3>
          <div class="skill-list two-col">
            <div class="skill-row"><span>Athletics (Str)</span><input type="text" name="skillAthletics" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Acrobatics (Dex)</span><input type="text" name="skillAcrobatics" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Sleight of Hand (Dex)</span><input type="text" name="skillSleightOfHand" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Stealth (Dex)</span><input type="text" name="skillStealth" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Arcana (Int)</span><input type="text" name="skillArcana" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>History (Int)</span><input type="text" name="skillHistory" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Investigation (Int)</span><input type="text" name="skillInvestigation" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Nature (Int)</span><input type="text" name="skillNature" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Religion (Int)</span><input type="text" name="skillReligion" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Animal Handling (Wis)</span><input type="text" name="skillAnimalHandling" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Insight (Wis)</span><input type="text" name="skillInsight" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Medicine (Wis)</span><input type="text" name="skillMedicine" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Perception (Wis)</span><input type="text" name="skillPerception" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Survival (Wis)</span><input type="text" name="skillSurvival" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Deception (Cha)</span><input type="text" name="skillDeception" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Intimidation (Cha)</span><input type="text" name="skillIntimidation" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Performance (Cha)</span><input type="text" name="skillPerformance" class="forge-input narrow" placeholder="+0" /></div>
            <div class="skill-row"><span>Persuasion (Cha)</span><input type="text" name="skillPersuasion" class="forge-input narrow" placeholder="+0" /></div>
          </div>
        </div>
      </div>

      <div class="form-card">
        <h3 class="form-heading">Proficiencies</h3>
        <div class="field-grid three-col">
          <div class="field">
            <label for="armorField">Armor</label>
            <textarea id="armorField" name="armor" class="forge-input" rows="3" placeholder="Light armor, shields..."></textarea>
          </div>
          <div class="field">
            <label for="weaponsField">Weapons</label>
            <textarea id="weaponsField" name="weapons" class="forge-input" rows="3" placeholder="Swords, daggers..."></textarea>
          </div>
          <div class="field">
            <label for="languagesField">Languages</label>
            <textarea id="languagesField" name="languages" class="forge-input" rows="3" placeholder="Common, Celestial..."></textarea>
          </div>
        </div>
      </div>

      <div class="forge-actions">
        <button type="submit" class="btn-ember">Submit</button>
        <a href="/characters" class="btn-ghost">Cancel</a>
      </div>
    </form>
  </section>

  <div class="gallery-modal-backdrop" data-gallery-modal hidden>
    <div class="gallery-modal-card">
      <div class="gallery-modal-header">
        <div>
          <p class="eyebrow">Image manager</p>
          <h4>Remove uploaded images</h4>
        </div>
        <button type="button" class="btn-ghost icon-only" data-modal-close aria-label="Close image manager">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <p class="gallery-modal-subtitle">Select any image below to remove it from this character.</p>
      <div class="gallery-modal-grid" data-modal-gallery></div>
      <div class="gallery-modal-actions">
        <button type="button" class="btn-ghost" data-modal-close>Close</button>
      </div>
    </div>
  </div>
</main>

<script src="/Script/gallery.js"></script>

<%- include('../partials/footer.ejs') %>